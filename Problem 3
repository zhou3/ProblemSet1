% creat gini function(found from website)
% GINI computes the Gini coefficient and the Lorentz curve.
%
% Usage:
%   g = gini(pop,val)
%   [g,l] = gini(pop,val)
%   [g,l,a] = gini(pop,val)
%   ... = gini(pop,val,makeplot)
%
% Input and Output:
%   pop     A vector of population sizes of the different classes.
%   val     A vector of the measurement variable (e.g. income per capita)
%           in the diffrerent classes.
%   g       Gini coefficient.
%   l       Lorentz curve: This is a two-column array, with the left
%           column representing cumulative population shares of the
%           different classes, sorted according to val, and the right
%           column representing the cumulative value share that belongs to
%           the population up to the given class. The Lorentz curve is a
%           scatter plot of the left vs the right column.
%   a       Same as l, except that the components are not normalized to
%           range in the unit interval. Thus, the left column of a is the
%           absolute cumulative population sizes of the classes, and the
%           right colun is the absolute cumulative value of all classes up
%           to the given one.
%   makeplot  is a boolean, indicating whether a figure of the Lorentz
%           curve should be produced or not. Default is false.
%
% Example:
%   x = rand(100,1);
%   y = rand(100,1);
%   gini(x,y,true);             % random populations with random incomes
%   figure;
%   gini(x,ones(100,1),true);   % perfect equality
%
% Explanation:
%
%   The vectors pop and val must be equally long and must contain only
%   positive values (zeros are also acceptable). A typical application
%   would be that pop represents population sizes of some subgroups (e.g.
%   different countries or states), and val represents the income per
%   capita in this different subgroups. The Gini coefficient is a measure
%   of how unequally income is distributed between these classes. A
%   coefficient of zero means that all subgroups have exactly the same
%   income per capital, so there is no dispesion of income; A very large
%   coefficient would result if all the income accrues only to one subgroup
%   and all the remaining groups have zero income. In the limit, when the
%   total population size approaches infinity, but all the income accrues
%   only to one individual, the Gini coefficient approaches unity.
%
%   The Lorenz curve is a graphical representation of the distribution. If
%   (x,y) is a point on the Lorenz curve, then the poorest x-share of the
%   population has the y-share of total income. By definition, (0,0) and
%   (1,1) are points on the Lorentz curve (the poorest 0% have 0% of total
%   income, and the poorest 100% [ie, everyone] have 100% of total income).
%   Equal distribution implies that the Lorentz curve is the 45 degree
%   line. Any inequality manifests itself as deviation of the Lorentz curve
%   from the  45 degree line. By construction, the Lorenz curve is weakly
%   convex and increasing.
%
%   The two concepts are related as follows: The Gini coefficient is twice
%   the area between the 45 degree line and the Lorentz curve.
%
% Author : Yvan Lengwiler
% Release: $1 .0$
% Date   : $2010-06-27$

function [g,l,a] = gini(pop,val,makeplot)

    % check arguments

    assert(nargin >= 2, 'gini expects at least two arguments.')

    if nargin < 3
        makeplot = false;
    end
    assert(numel(pop) == numel(val), ...
        'gini expects two equally long vectors (% d ~= % d).', ...
        size(pop,1),size(val,1))

    pop = [0;pop(:)]; val = [0;val(:)];     % pre-append a zero

    isok = all (~isnan([pop,val]'))';        % filter out NaNs
    if sum(isok) < 2
        warning('gini:lacking_data','not enough data');
        g = NaN; l = NaN(1,4);
        return;
    end
    pop = pop(isok); val = val(isok);
    
    assert(all(pop>=0) && all(val>=0), ...
        'gini expects nonnegative vectors (neg elements in pop = % d, in val = % d).', ...
        sum(pop<0),sum(val<0))
    
    % process input
    z = val .* pop;
    [~,ord] = sort(val);
    pop    = pop(ord);     z    = z(ord);
    pop    = cumsum(pop);  z    = cumsum(z);
    relpop = pop/pop(end); relz = z/z(end);
    
    % Gini coefficient

    % We compute the area below the Lorentz curve. We do this by
    % computing the average of the left and right Riemann-like sums.
    % (I say Riemann-'like' because we evaluate not on a uniform grid, but
    % on the points given by the pop data).
    %
    % These are the two Rieman-like sums:
    %    leftsum  = sum(relz (1:end-1) .* diff(relpop));
    %    rightsum = sum(relz (2:end)   .* diff(relpop));
    % The Gini coefficient is one minus twice the average of leftsum and
    % rightsum. We can put all of this into one line.
    g = 1 - sum((relz(1:end-1)+relz(2:end)) .* diff(relpop));
    
    % Lorentz curve
    l = [relpop,relz];
    a = [pop,z];
    if makeplot   % ... plot it?
        area(relpop,relz,'FaceColor',[0.5,0.5,1.0]);    % the Lorentz curve
        hold on
        plot([0,1],[0,1],'--k');                        % 45 degree line
        axis tight      % ranges of abscissa and ordinate are by definition exactly [0,1]
        axis square     % both axes should be equally long
        set(gca,'XTick',get(gca,'YTick'))   % ensure equal ticking
        set(gca,'Layer','top');             % grid above the shaded area
        grid on;
        title(['\bfGini coefficient = ',num2str(g)]);
        xlabel('share of population');
        ylabel('share of value');
    end
    
end 

% create table 1
Quantiles = {'Earnings';'Income';'Wealth'};
Quantiles0=[quantile(WAGEINC,0);quantile(INCOME,0);quantile(ASSET,0)];
Quantiles1=[quantile(WAGEINC,0.01);quantile(INCOME,0.01);quantile(ASSET,0.01)];
Quantiles5=[quantile(WAGEINC,0.05);quantile(INCOME,0.05);quantile(ASSET,0.05)];
Quantiles10=[quantile(WAGEINC,0.1);quantile(INCOME,0.1);quantile(ASSET,0.1)];
Quantiles20=[quantile(WAGEINC,0.2);quantile(INCOME,0.2);quantile(ASSET,0.2)];
Quantiles40=[quantile(WAGEINC,0.4);quantile(INCOME,0.4);quantile(ASSET,0.4)];
Quantiles60=[quantile(WAGEINC,0.6);quantile(INCOME,0.6);quantile(ASSET,0.6)];
Quantiles80=[quantile(WAGEINC,0.8);quantile(INCOME,0.8);quantile(ASSET,0.8)];
Quantiles90=[quantile(WAGEINC,0.9);quantile(INCOME,0.9);quantile(ASSET,0.9)];
Quantiles95=[quantile(WAGEINC,0.95);quantile(INCOME,0.95);quantile(ASSET,0.95)];
Quantiles99=[quantile(WAGEINC,0.99);quantile(INCOME,0.99);quantile(ASSET,0.99)];
Quantiles100=[quantile(WAGEINC,1);quantile(INCOME,1);quantile(ASSET,1)];

T=table(Quantiles,Quantiles0,Quantiles1,Quantiles5,Quantiles10,Quantiles20,Quantiles40,Quantiles60,Quantiles80,Quantiles90,Quantiles99,Quantiles100);
    
%create table 2
X1=rand(22085,1);
B1=sort(WAGEINC);
A1=find(abs(B1-mean(WAGEINC))<400);
X2=log(WAGEINC);
V2=X2(X2>0);
Earnings=[std (WAGEINC)/mean(WAGEINC);var(V2);gini(X1,WAGEINC);quantile (WAGEINC,0.99)/quantile(WAGEINC,0.4);A1 (1,1)/22085;mean (WAGEINC)/median(WAGEINC)];

X1=rand(22085,1);
B2=sort(INCOME);
A2=find(abs(B2-mean(INCOME))<4000);
X3=log(WAGEINC);
V3=X3(X3>0);
Income=[std (INCOME)/mean(INCOME);var(V3);gini(X1,INCOME);quantile (INCOME,0.99)/quantile(INCOME,0.4);A2 (1,1)/22085;mean (INCOME)/median(INCOME)];

X1=rand(22085,1);
B3=sort(ASSET);
A3=find(abs(B3-mean(ASSET))<4000);
X4=log(ASSET);
V4=X4(X4>0);
Wealth=[std (ASSET)/mean(ASSET);var(V4);gini(X1,ASSET);quantile (ASSET,0.99)/quantile(ASSET,0.4);A3 (1,1)/22085;mean (ASSET)/median(ASSET)];

Statstics={'Coefficient of variation';'Variance of the logs';'Gini index';'Top 1 %/ lowest 40%';'Location of mean (%)' ;'Mean / median'};
T=table(Statstics,Earnings,Income,Wealth);
